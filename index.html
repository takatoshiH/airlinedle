<html>
<head>
    <link rel="stylesheet" href="airdle.css">
</head>
<h1 style="text-align: center">Airdle</h1>
<h3 style="text-align: center">国内線を運行している航空会社の3レターを入れよう！</h3>
<h4 style="text-align: center"><a href="https://www.nytimes.com/games/wordle/index.html" target="_blank">ルールはこちらを参考に</a></h4>
<div style="text-align: center;">
    <div class="record">
        <input id="1_1" maxlength="1" class="input">
        <input id="1_2" maxlength="1" class="input">
        <input id="1_3" maxlength="1" class="input">
        <button id="1_submit">決定</button>
    </div>
    <div class="record">
        <input id="2_1" maxlength="1" disabled class="input">
        <input id="2_2" maxlength="1" disabled class="input">
        <input id="2_3" maxlength="1" disabled class="input">
        <button id="2_submit" disabled>決定</button>
    </div>
    <div class="record">
        <input id="3_1" maxlength="1" disabled class="input">
        <input id="3_2" maxlength="1" disabled class="input">
        <input id="3_3" maxlength="1" disabled class="input">
        <button id="3_submit" disabled>決定</button>
    </div>

<!--    正解時のmodal-->
    <div class="popup" id="js-popup">
        <div class="popup-inner">
            <img src="happy.png">
            <button id="next">Next</button>
        </div>
        <div class="black-background" id="js-black-bg"></div>
    </div>

    <!--    不正解時のmodal-->
    <div class="popup" id="js-popup-lose">
        <div class="popup-inner">
            <img src="lose.png">
            <div id="answer-airline"></div>
            <button id="next-lose">Next</button>
        </div>
        <div class="black-background" id="js-black-bg-lose"></div>
    </div>
</html>

<script>
    const airlines = ["ANA", "ADO", "IBX", "ORC", "SFJ", "SNA", "JAL", "HAC", "JAC", "SKY", "JST", "APJ", "FDA", "SJO", "VNL", "AHX", "WAJ"];
    const answer = airlines[Math.floor(Math.random() * (airlines.length - 1))];
    const splited_answer = answer.split("");

    console.log(answer);

    // 一列目
    document.getElementById("1_submit").addEventListener("click", () => {
        const recordNumber = 1;
        let [first_input, second_input, third_input, button] = getNeededDoms(recordNumber);

        const first = first_input.value;
        const second = second_input.value;
        const third = third_input.value;
        const airline = first + second + third;

        //正解の時
        if(airline === answer) {
            showModal();
            return;
        }

        if(!airlines.includes(airline)) {
            alert("そのような航空会社はありません");
            return;
        }

        let results = [];

        for (let index = 0; index < splited_answer.length; index++) {
            const word = answer[index];
            if(index == 0) results.push(giveResult(word, first));
            if(index == 1) results.push(giveResult(word, second));
            if(index == 2) results.push(giveResult(word, third));
        }

        button.setAttribute("disabled", true);
        first_input.setAttribute("disabled", true);
        second_input.setAttribute("disabled", true);
        third_input.setAttribute("disabled", true);

        for (let index = 0; index < results.length; index++) {
            const result = results[index];
            if(index === 0) giveResultClass(result, first_input);
            if(index === 1) giveResultClass(result, second_input);
            if(index === 2) giveResultClass(result, third_input);
        }

        removeDisabled(2);
    });

    // 二列目
    document.getElementById("2_submit").addEventListener("click", () => {
        const recordNumber = 2;
        let [first_input, second_input, third_input, button] = getNeededDoms(recordNumber);

        const first = first_input.value;
        const second = second_input.value;
        const third =third_input.value;
        const airline = first + second + third;

        //正解の時
        if(airline === answer) {
            showModal();
            return;
        }

        if(!airlines.includes(airline)) {
            alert("そのような航空会社はありません");
            return;
        }

        let results = [];

        for (let index = 0; index < splited_answer.length; index++) {
            const word = answer[index];
            if(index == 0) results.push(giveResult(word, first));
            if(index == 1) results.push(giveResult(word, second));
            if(index == 2) results.push(giveResult(word, third));
        }

        button.setAttribute("disabled", true);
        first_input.setAttribute("disabled", true);
        second_input.setAttribute("disabled", true);
        third_input.setAttribute("disabled", true);

        for (let index = 0; index < results.length; index++) {
            const result = results[index];
            if(index === 0) giveResultClass(result, first_input);
            if(index === 1) giveResultClass(result, second_input);
            if(index === 2) giveResultClass(result, third_input);

        }

        removeDisabled(3);
    });

    // 三列目
    document.getElementById("3_submit").addEventListener("click", () => {
        const recordNumber = 3;
        let [first_input, second_input, third_input, button] = getNeededDoms(recordNumber);

        const first = first_input.value;
        const second = second_input.value;
        const third =third_input.value;
        const airline = first + second + third;

        //正解の時
        if(airline === answer) {
            showModal();
            return;
        }

        if(!airlines.includes(airline)) {
            alert("そのような航空会社はありません");
            return;
        }

        let results = [];

        for (let index = 0; index < splited_answer.length; index++) {
            const word = answer[index];
            if(index == 0) results.push(giveResult(word, first));
            if(index == 1) results.push(giveResult(word, second));
            if(index == 2) results.push(giveResult(word, third));
        }

        button.setAttribute("disabled", true);
        first_input.setAttribute("disabled", true);
        second_input.setAttribute("disabled", true);
        third_input.setAttribute("disabled", true);

        for (let index = 0; index < results.length; index++) {
            const result = results[index];
            if(index === 0) giveResultClass(result, first_input);
            if(index === 1) giveResultClass(result, second_input);
            if(index === 2) giveResultClass(result, third_input);
        }
        showModalLose();
    });

    function giveResultClass(result, input) {
        input.classList.add(result);
    }

    function getNeededDoms(index) {
        const first_input = document.getElementById(`${index}_1`);
        const second_input = document.getElementById(`${index}_2`);
        const third_input = document.getElementById(`${index}_3`);
        const button = document.getElementById(`${index}_submit`);

        return [first_input, second_input, third_input, button];
    }

    function removeDisabled(index) {
        document.getElementById(`${index}_submit`).removeAttribute("disabled");
        document.getElementById(`${index}_1`).removeAttribute("disabled");
        document.getElementById(`${index}_2`).removeAttribute("disabled");
        document.getElementById(`${index}_3`).removeAttribute("disabled");
    }

    function giveResult(word, partOfAnswer) {
        if(word === partOfAnswer) {
            return "correct";
        } else if(answer.includes(partOfAnswer)) {
            return "include";
        } else {
            return "wrong";
        }
    }

    function showModal() {
        let popup = document.getElementById('js-popup');
        popup.classList.add('is-show');
        closePopUp(document.getElementById('js-black-bg'));
    }

    function showModalLose() {
        let popup = document.getElementById('js-popup-lose');
        popup.classList.add('is-show');
        document.getElementById("answer-airline").textContent = `正解は${answer}でした`;
        closePopUpLose(document.getElementById('js-black-bg-lose'));
    }

    function closePopUp(elem) {
        if(!elem) return;
        elem.addEventListener('click', function() {
            let popup = document.getElementById('js-popup');
            popup.classList.remove('is-show');
        })
    }

    function closePopUpLose(elem) {
        if(!elem) return;
        elem.addEventListener('click', function() {
            let popup = document.getElementById('js-popup-lose');
            popup.classList.remove('is-show');
        })
    }

    document.getElementById("next").addEventListener("click", () => {
       location.reload();
    });

    document.getElementById("next-lose").addEventListener("click", () => {
        location.reload();
    });

    document.getElementById("1_1").addEventListener("input", () => {
        document.getElementById("1_1").value =  document.getElementById("1_1").value.toUpperCase();
        document.getElementById("1_2").focus();
    });

    document.getElementById("1_2").addEventListener("input", () => {
        document.getElementById("1_2").value =  document.getElementById("1_2").value.toUpperCase();
        document.getElementById("1_3").focus();
    });

    document.getElementById("1_3").addEventListener("input", () => {
        document.getElementById("1_3").value =  document.getElementById("1_3").value.toUpperCase();
        document.getElementById("1_submit").focus();
    });

    document.getElementById("1_submit").addEventListener("click", () => {
        document.getElementById("2_1").focus();
    });

    document.getElementById("2_1").addEventListener("input", () => {
        document.getElementById("2_1").value =  document.getElementById("2_1").value.toUpperCase();
        document.getElementById("2_2").focus();
    });

    document.getElementById("2_2").addEventListener("input", () => {
        document.getElementById("2_2").value =  document.getElementById("2_2").value.toUpperCase();
        document.getElementById("2_3").focus();
    });

    document.getElementById("2_3").addEventListener("input", () => {
        document.getElementById("2_3").value =  document.getElementById("2_3").value.toUpperCase();
        document.getElementById("2_submit").focus();
    });

    document.getElementById("2_submit").addEventListener("click", () => {
        document.getElementById("3_1").focus();
    });

    document.getElementById("3_1").addEventListener("input", () => {
        document.getElementById("3_1").value =  document.getElementById("3_1").value.toUpperCase();
        document.getElementById("3_2").focus();
    });

    document.getElementById("3_2").addEventListener("input", () => {
        document.getElementById("3_2").value =  document.getElementById("3_2").value.toUpperCase();
        document.getElementById("3_3").focus();
    });

    document.getElementById("3_3").addEventListener("input", () => {
        document.getElementById("3_3").value =  document.getElementById("3_3").value.toUpperCase();
        document.getElementById("3_submit").focus();
    });

</script>